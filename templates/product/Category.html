{% extends 'base/_base.html' %}
{% load static %}
{% block title %}Product{% endblock %}
{% block extra_head %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'TreeList.css' %}">


{% endblock %}
{% block content %}
    <h1 class="product-title">Category Item</h1>
    <div class="container-fluid">
        <div class="row">
            <div class="col-3">
                <div class="container-fluid">
                    <ul id="myUL">
                        {% for cat in cateles %}
                            {% if not cat.parent %}
                                <li><span class="caret parent" cate_id="{{ cat.id }}"
                                          style="color: #613400"> {{ cat.name }}</span>
                                    <ul class="nested">
                                        {% for cat1 in cateles %}
                                            {% if cat1.parent_id == cat.id %}
                                                <li><span class="caret parent"
                                                          cate_id="{{ cat1.id }}"
                                                          style="color: #d48806">{{ cat1.name }}</span>
                                                    <ul class="nested">
                                                        {% for cat2 in cateles %}
                                                            {% if cat2.parent_id == cat1.id %}
                                                                <li><span class="caret parent"
                                                                          cate_id="{{ cat2.id }}"
                                                                          style="color: #ffd666">{{ cat2.name }}</span>
                                                                </li>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </ul>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="col-9">
                <section class="product-list">
                    <div class="container">
                        <div class="row">
                            <div class="to_fill "
                                 style="margin: 0;padding: 0;border: 0;display: flex; flex-wrap: wrap;">
                                <!--STRT ITEM-->
                                {#                                <div class="item " style="display: flex; flex-wrap: wrap;">#}
                                {#                                    <div class="product">#}
                                {#                                        <div class="product-thumb">#}
                                {#                                            <img class="pro-thumb-img click-to-product" akbar="{{ cat.id }}"#}
                                {#                                                 src="{% if cat.image %} {{ cat.image.url }} {% else %} {% static 'default/shop-basket-icon-orange-sticker-vector-1789934.jpg' %} {% endif %}"#}
                                {#                                                 alt="{{ cat.name }}">#}
                                {#                                            <div class="product-button ">#}
                                {#                                                <a href="{{ cat.category_set }}" title="Quick View">#}
                                {#                                                    <i class="fas fa-eye"></i>#}
                                {#                                                </a>#}
                                {#                                                <a href="#" title="Add To Cart">#}
                                {#                                                    <i class="fas fa-shopping-bag"></i>#}
                                {#                                                </a>#}
                                {#                                            </div>#}
                                {#                                        </div>#}
                                {#                                        <div class="product-info">#}
                                {#                                            <h3 class="product-name">{{ cat.name }}</h3>#}
                                {##}
                                {#                                            <div class="off-info">#}
                                {#                                            </div>#}
                                {#                                        </div>#}
                                {#                                    </div>#}
                                {#                                </div>#}
                                <!--END ITEM-->
                            </div>
                        </div>

                    </div>
                </section>
            </div>
        </div>
    </div>
    {#    <input id="log" type="button" value="login">#}
    <script>
        var toggler = document.getElementsByClassName("caret");
        console.log(toggler)
        var i;

        for (i = 0; i < toggler.length; i++) {
            toggler[i].addEventListener("click", function () {
                this.parentElement.querySelector(".nested").classList.toggle("active");
                this.classList.toggle("caret-down");
            });
        }

        $('.parent').click(function () {
            var par = $(this).attr('cate_id')
            console.log(par)
            let JsonData = {'category_id': par};
            $.ajax({
                type: "GET",
                url: 'http://127.0.0.1:8000/product/product_list_api/',
                data: JsonData,
                success: function (response) {
                    {#if#}
                    $('.to_fill').html('')
                    for (let i of response) {
                        $(`<div class="item col-5 " style="display: flex; flex-wrap: wrap;">
                                    <div class="product shadow-sm">
                                        <div class="product-thumb">
                                            <img class="pro-thumb-img click-to-product"
                                                 src="${i['image']}"
                                                 alt="${i['name']}">
                                            <div class="product-button ">
                                                <a href="http://127.0.0.1:8000/product/product_detail/${i['id']}" title="Quick View">
                                                    <i class="fas fa-eye "></i>
                                                </a>
                                                <a href="#" title="Add To Cart" class="click_to_add1" product_id_cookie=${i['id']}>
                                                    <i class="fas fa-shopping-bag click_to_add" product_id_cookie=${i['id']} ></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="product-info">
{#                                            <h3 class="product-name">${i['brand']['name']}</h3>#}
                                            <h3 class="product-name">${i['name']}</h3>
                                            <h3 class="product-name">${i['price']}</h3>

                                            <div class="off-info">
                                            </div>
                                        </div>
                                    </div>
                                </div>`).appendTo($('.to_fill'))
                        console.log(i)
                    }

                },
                error: function () {
                    console.log('error')
                }
            })
        })

        {#$('.click_to_add').click(function () {#}
        {#    console.log('test')#}
        {#    let JsonData = {'increase': 1}#}
        {#    $.ajax({#}
        {#        type: "GET",#}
        {#        url: 'http://127.0.0.1:8000/order/add_cart/',#}
        {#        data: JsonData,#}
        {#        success: function (response) {#}
        {#            console.log(response)#}
        {##}
        {#        },#}
        {#        error: function () {#}
        {#            console.log('error')#}
        {#        }#}
        {#    })#}


        $('.click_to_add1').click(function () {
            console.log('test')
            let id_product = $(this).attr('product_id_cookie')
            console.log(id_product)
            let JsonData = {'increase': 1}
            $.ajax({
                type: "GET",
                url: 'http://127.0.0.1:8000/order/add_cart/',
                data: JsonData,
                success: function (response) {
                    console.log(response)

                },
                error: function () {
                    console.log('error')
                }
            })
        })


    </script>
{% endblock %}
